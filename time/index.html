<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Display</title>
  <link rel="stylesheet" href="../assets/css/time.css">
</head>
<body>
  <div id="timeDisplay"></div>

  <!-- Gear / Close button -->
  <button id="gearBtn" class="gear-btn">⚙</button>

  <!-- Settings menu -->
  <div id="menu" class="menu hidden">
    <label>Font Size:
      <input type="range" id="fontSize" min="50" max="600" value="120">
    </label>

    <label>Font:
      <select id="fontSelect">
        <option value="Arial">Arial</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Impact">Impact</option>
        <option value="Tahoma">Tahoma</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Verdana">Verdana</option>
        <option value="Monospace">Monospace</option>
      </select>
    </label>

    <label>Font Color:
      <input type="color" id="fontColor" value="#ffffff">
    </label>

    <label>Background Color:
      <input type="color" id="bgColor" value="#000000">
    </label>

    <label>Time Zone:
      <select id="timeZone"></select>
    </label>

    <label>Format:
      <select id="timeFormat">
        <option value="24">24-hour</option>
        <option value="12">12-hour</option>
      </select>
    </label>
  </div>

  <script>
    const timeDisplay = document.getElementById("timeDisplay");
    const menu = document.getElementById("menu");
    const gearBtn = document.getElementById("gearBtn");

    const fontSize = document.getElementById("fontSize");
    const fontSelect = document.getElementById("fontSelect");
    const fontColor = document.getElementById("fontColor");
    const bgColor = document.getElementById("bgColor");
    const timeZoneSelect = document.getElementById("timeZone");
    const timeFormat = document.getElementById("timeFormat");

    let hideTimeout;

    // Load time zones
    const timeZones = Intl.supportedValuesOf("timeZone");
    timeZones.forEach(tz => {
      const offset = new Date().toLocaleTimeString("en-US", {
        timeZone: tz,
        timeZoneName: "short"
      }).split(" ").pop();
      const option = document.createElement("option");
      option.value = tz;
      option.textContent = `${tz.replace("_", " ")} (${offset})`;
      timeZoneSelect.appendChild(option);
    });
    timeZoneSelect.value = "Indian/Maldives";

    function updateTime() {
      const tz = timeZoneSelect.value;
      const format = timeFormat.value;
      const options = {
        hour: "numeric",
        minute: "numeric",
        second: "numeric",
        timeZone: tz
      };
      if (format === "24") {
        options.hour12 = false;
      } else {
        options.hour12 = true;
      }
      const now = new Date().toLocaleTimeString([], options);
      timeDisplay.textContent = now;
    }

    setInterval(updateTime, 1000);
    updateTime();

    // Apply settings
    function applySettings() {
      timeDisplay.style.fontSize = fontSize.value + "px";
      timeDisplay.style.fontFamily = fontSelect.value;
      timeDisplay.style.color = fontColor.value;
      document.body.style.backgroundColor = bgColor.value;
    }
    applySettings();

    [fontSize, fontSelect, fontColor, bgColor, timeZoneSelect, timeFormat]
      .forEach(el => el.addEventListener("input", () => {
        applySettings();
        saveSettings();
        // Close dropdown automatically
        if (el.tagName === "SELECT") el.blur();
      }));

    // Save settings
    function saveSettings() {
      localStorage.setItem("timeSettings", JSON.stringify({
        fontSize: fontSize.value,
        font: fontSelect.value,
        fontColor: fontColor.value,
        bgColor: bgColor.value,
        timeZone: timeZoneSelect.value,
        format: timeFormat.value
      }));
    }

    // Load settings
    function loadSettings() {
      const s = JSON.parse(localStorage.getItem("timeSettings"));
      if (!s) return;
      fontSize.value = s.fontSize;
      fontSelect.value = s.font;
      fontColor.value = s.fontColor;
      bgColor.value = s.bgColor;
      timeZoneSelect.value = s.timeZone;
      timeFormat.value = s.format;
      applySettings();
    }
    loadSettings();

    // Menu toggle
    function showMenu() {
      menu.classList.remove("hidden");
      gearBtn.textContent = "✖"; // Change to close button
      resetHideTimer();
    }

    function hideMenu() {
      menu.classList.add("hidden");
      gearBtn.textContent = "⚙"; // Back to gear
    }

    function resetHideTimer() {
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        hideMenu();
        gearBtn.style.opacity = "0";
      }, 5000);
    }

    // Gear button click
    gearBtn.addEventListener("click", () => {
      if (menu.classList.contains("hidden")) {
        showMenu();
      } else {
        hideMenu();
      }
    });

    // Gear button show on hover
    document.body.addEventListener("mousemove", () => {
      gearBtn.style.opacity = "1";
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        if (menu.classList.contains("hidden")) {
          gearBtn.style.opacity = "0";
        }
      }, 5000);
    });

    // Fullscreen shortcut (F)
    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === "f") {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      }
    });
  </script>
</body>
</html>
