<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Display</title>
  <link rel="stylesheet" href="../assets/css/time.css">
</head>
<body>
  <div class="wrap">
    <div id="clock"></div>
  </div>

  <!-- Gear / Close button -->
  <button id="gearBtn" class="gear">⚙</button>

  <!-- Controls -->
  <div id="controls" class="controls hidden">
    <div class="control-row">
      <label>Font Size</label>
      <input type="range" id="fontSize" min="50" max="600" value="120">
    </div>

    <div class="control-row">
      <label>Font</label>
      <div class="custom-select-wrapper">
        <div class="custom-select" data-value="Arial">Arial</div>
        <ul class="custom-options">
          <li data-value="Arial">Arial</li>
          <li data-value="Courier New">Courier New</li>
          <li data-value="Georgia">Georgia</li>
          <li data-value="Impact">Impact</li>
          <li data-value="Tahoma">Tahoma</li>
          <li data-value="Times New Roman">Times New Roman</li>
          <li data-value="Verdana">Verdana</li>
          <li data-value="Monospace">Monospace</li>
        </ul>
      </div>
    </div>

    <div class="control-row">
      <label>Font Color</label>
      <input type="color" id="fontColor" value="#ffffff">
    </div>

    <div class="control-row">
      <label>Background</label>
      <input type="color" id="bgColor" value="#000000">
    </div>

    <div class="control-row">
      <label>Time Zone</label>
      <div class="custom-select-wrapper">
        <div class="custom-select" data-value="Indian/Maldives">Indian/Maldives</div>
        <ul id="timeZoneOptions" class="custom-options"></ul>
      </div>
    </div>

    <div class="control-row">
      <label>Format</label>
      <div class="custom-select-wrapper">
        <div class="custom-select" data-value="24">24-hour</div>
        <ul class="custom-options">
          <li data-value="24">24-hour</li>
          <li data-value="12">12-hour</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const clock = document.getElementById("clock");
    const gearBtn = document.getElementById("gearBtn");
    const controls = document.getElementById("controls");
    const fontSize = document.getElementById("fontSize");
    const fontColor = document.getElementById("fontColor");
    const bgColor = document.getElementById("bgColor");
    const timeZoneOptions = document.getElementById("timeZoneOptions");
    let hideTimeout;

    // Load supported timezones
    const zones = Intl.supportedValuesOf("timeZone");
    zones.forEach(tz => {
      const offset = new Date().toLocaleTimeString("en-US", {
        timeZone: tz,
        timeZoneName: "short"
      }).split(" ").pop();
      const li = document.createElement("li");
      li.dataset.value = tz;
      li.textContent = `${tz.replace("_", " ")} (${offset})`;
      timeZoneOptions.appendChild(li);
    });

    // Defaults
    let settings = {
      fontSize: "120",
      font: "Arial",
      fontColor: "#ffffff",
      bgColor: "#000000",
      timeZone: "Indian/Maldives",
      format: "24"
    };

    // Load saved settings
    if (localStorage.getItem("timeSettings")) {
      settings = JSON.parse(localStorage.getItem("timeSettings"));
    }

    // Apply settings
    function applySettings() {
      clock.style.fontSize = settings.fontSize + "px";
      clock.style.fontFamily = settings.font;
      clock.style.color = settings.fontColor;
      document.body.style.backgroundColor = settings.bgColor;
      document.querySelectorAll(".custom-select").forEach(sel => {
        if (sel.dataset.value === settings.font ||
            sel.dataset.value === settings.timeZone ||
            sel.dataset.value === settings.format) {
          sel.textContent = sel.dataset.value;
        }
      });
    }

    function saveSettings() {
      localStorage.setItem("timeSettings", JSON.stringify(settings));
    }

    // Clock update
    function updateClock() {
      const options = {
        hour: "numeric",
        minute: "numeric",
        second: "numeric",
        timeZone: settings.timeZone,
        hour12: settings.format === "12"
      };
      clock.textContent = new Date().toLocaleTimeString([], options);
    }
    setInterval(updateClock, 1000);
    updateClock();
    applySettings();

    // Events
    fontSize.addEventListener("input", e => {
      settings.fontSize = e.target.value;
      applySettings();
      saveSettings();
    });

    fontColor.addEventListener("input", e => {
      settings.fontColor = e.target.value;
      applySettings();
      saveSettings();
    });

    bgColor.addEventListener("input", e => {
      settings.bgColor = e.target.value;
      applySettings();
      saveSettings();
    });

    // Custom dropdown handling
    document.querySelectorAll(".custom-select").forEach(select => {
      select.addEventListener("click", function () {
        document.querySelectorAll(".custom-options.open").forEach(opt => {
          if (opt !== this.nextElementSibling) opt.classList.remove("open");
        });
        this.nextElementSibling.classList.toggle("open");
      });
    });

    document.querySelectorAll(".custom-options").forEach(optList => {
      optList.addEventListener("click", function (e) {
        if (e.target.tagName === "LI") {
          const value = e.target.dataset.value;
          const display = this.previousElementSibling;
          display.textContent = e.target.textContent;
          display.dataset.value = value;
          this.classList.remove("open");

          if (display.closest(".control-row").querySelector("label").textContent.includes("Font")) {
            settings.font = value;
          } else if (display.closest(".control-row").querySelector("label").textContent.includes("Time Zone")) {
            settings.timeZone = value;
          } else if (display.closest(".control-row").querySelector("label").textContent.includes("Format")) {
            settings.format = value;
          }
          applySettings();
          saveSettings();
        }
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener("click", function (e) {
      if (!e.target.closest(".custom-select-wrapper")) {
        document.querySelectorAll(".custom-options.open").forEach(opt => opt.classList.remove("open"));
      }
    });

    // Gear toggle
    gearBtn.addEventListener("click", () => {
      if (controls.classList.contains("hidden")) {
        controls.classList.remove("hidden");
        gearBtn.textContent = "✖";
        resetHideTimer();
      } else {
        controls.classList.add("hidden");
        gearBtn.textContent = "⚙";
      }
    });

    function resetHideTimer() {
      clearTimeout(hideTimeout);
      hideTimeout = setTimeout(() => {
        controls.classList.add("hidden");
        gearBtn.textContent = "⚙";
        gearBtn.style.opacity = "0";
      }, 5000);
    }

    // Show gear on mouse move
    document.body.addEventListener("mousemove", () => {
      gearBtn.style.opacity = "1";
      if (controls.classList.contains("hidden")) resetHideTimer();
    });

    // Fullscreen toggle with F
    document.addEventListener("keydown", e => {
      if (e.key.toLowerCase() === "f") {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      }
    });
  </script>
</body>
</html>
